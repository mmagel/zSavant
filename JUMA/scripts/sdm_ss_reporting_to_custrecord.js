//function cstest(type,status){

//    var role = nlapiGetContext().role;

//    if (role == "3"){

/*
54380,
54392,
54404,
54416,
54428,
*/

    budget_ids = [    
    63699,
    54440,
    54452,
    54464,
    54476,
    54488,
    54500,
    54512,
    54524,
    54536,
    54547,
    54559,
    54571,
    54583,
    54595,
    54607,
    54619,
    54631,
    54643,
    54655,
    54667,
    54679,
    54691,
    54703,
    54715,
    54727,
    54739,
    54751,
    54763,
    54775,
    54784,
    54796,
    54808,
    54820,
    54832,
    54844,
    54856,
    54868,
    54880,
    54892,
    54904,
    54916,
    54928,
    54940,
    54952,
    54964,
    54976,
    54988,
    54995,
    55007,
    55019,
    55031,
    55043,
    55055,
    55067,
    55079,
    55091,
    55103,
    55115,
    55127,
    55139,
    55151,
    55163,
    55175,
    55187,
    55199,
    55211,
    55223,
    55235,
    55247,
    55259,
    55271,
    55283,
    55294,
    55306,
    55316,
    55328,
    55340,
    55352,
    55363,
    55374,
    55385,
    55396,
    55408,
    55420,
    55432,
    55444,
    55456,
    55468,
    55480,
    55492,
    55502,
    55514,
    55526,
    55538,
    55550,
    55562,
    55574,
    55586,
    55598,
    55610,
    55622,
    55634,
    55646,
    55658,
    55670,
    55680,
    55692,
    55704,
    55716,
    55728,
    55740,
    55752,
    55764,
    55776,
    55788,
    55800,
    55812,
    55824,
    55836,
    55848,
    55860,
    55872,
    55884,
    55896,
    55908,
    55920,
    55932,
    55944,
    55956,
    55968,
    55980,
    55992,
    56004,
    56016,
    56028,
    56040,
    56052,
    56064,
    56076,
    56088,
    56100,
    56112,
    56124,
    56136,
    56148,
    56160,
    56172,
    56184,
    56196,
    56208,
    56220,
    56232,
    56244,
    56256,
    56268,
    56280,
    56292,
    56304,
    56316,
    56328,
    56340,
    56352,
    56364,
    56376,
    56388,
    56400,
    56412,
    56424,
    56436,
    56448,
    56460,
    56472,
    56484,
    56496,
    56508,
    56520,
    56532,
    56544,
    56556,
    56568,
    56580,
    56592,
    56604,
    56616,
    56628,
    56640,
    56652,
    56664,
    56675,
    56687,
    56699,
    56711,
    56723,
    56735,
    56747,
    56759,
    56760,
    56772,
    56784,
    56796,
    56808,
    56820,
    56832,
    56844,
    56856,
    56868,
    56880,
    56892,
    56904,
    56916,
    56928,
    56940,
    56952,
    56964,
    56976,
    56988,
    57000,
    57012,
    57024,
    57036,
    57048,
    57060,
    57072,
    57084,
    57096,
    57108,
    57120,
    57132,
    57144,
    57156,
    57168,
    57180,
    57192,
    57193,
    57205,
    57217,
    57229,
    57241,
    57253,
    57265,
    57277,
    57289,
    57301,
    57313,
    57325,
    57337,
    57349,
    57360,
    57370,
    57380,
    57390,
    57402,
    57414,
    57426,
    57438,
    57450,
    57462,
    57474,
    57486,
    57498,
    57510,
    57522,
    57534,
    57546,
    57558,
    57570,
    57582,
    57594,
    57605,
    57617,
    57629,
    57641,
    57653,
    57665,
    57677,
    57688,
    57700,
    57712,
    57724,
    57736,
    57748,
    57760,
    57772,
    57784,
    57796,
    57808,
    57820,
    57832,
    57844,
    57856,
    57868,
    57880,
    57892,
    57904,
    57916,
    57928,
    57940,
    57952,
    57964,
    57976,
    57988,
    58000,
    58012,
    58024,
    58036,
    58048,
    58060,
    58072,
    58084,
    58096,
    58108,
    58120,
    58132,
    58144,
    58156,
    58168,
    58180,
    58192,
    58204,
    58216,
    58228,
    58240,
    58252,
    58264,
    58276,
    58288,
    58300,
    58312,
    58324,
    58336,
    58348,
    58360,
    58372,
    58384,
    58396,
    58408,
    58420,
    58432,
    58444,
    58456,
    58468,
    58480,
    58492,
    58503,
    58515,
    58527,
    58539,
    58551,
    58563,
    58575,
    58587,
    58599,
    58611,
    58623,
    58635,
    58647,
    58659,
    58671,
    58683,
    58695,
    58707,
    58719,
    58731,
    58743,
    58755,
    58767,
    58779,
    58791,
    58803,
    58815,
    58827,
    58839,
    58851,
    58863,
    58875,
    58887,
    58899,
    58911,
    58923,
    58935,
    58947,
    58959,
    58971,
    58983,
    58995,
    59007,
    59019,
    59031,
    59043,
    59055,
    59067,
    59079,
    59091,
    59103,
    59115,
    59127,
    59139,
    59151,
    59163,
    59175,
    59187,
    59199,
    59211,
    59223,
    59235,
    59247,
    59259,
    59271,
    59283,
    59295,
    59307,
    59319,
    59331,
    59343,
    59355,
    59367,
    59379,
    59391,
    59402,
    59414,
    59426,
    59438,
    59450,
    59462,
    59474,
    59486,
    59498,
    59510,
    59522,
    59534,
    59546,
    59558,
    59570,
    59582,
    59594,
    59606,
    59618,
    59630,
    59642,
    59654,
    59665,
    59677,
    59689,
    59701,
    59713,
    59725,
    59737,
    59749,
    59761,
    59773,
    59785,
    59797,
    59809,
    59821,
    59833,
    59845,
    59857,
    59869,
    59881,
    59893,
    59905,
    59917,
    59929,
    59941,
    59953,
    59965,
    59977,
    59989,
    60001,
    60013,
    60025,
    60037,
    60049,
    60061,
    60073,
    60085,
    60097,
    60109,
    60121,
    60133,
    60145,
    60154,
    60166,
    60178,
    60190,
    60202,
    60214,
    60226,
    60238,
    60250,
    60262,
    60274,
    60286,
    60298,
    60308,
    60319,
    60331,
    60343,
    60355,
    60367,
    60379,
    60391,
    60403,
    60415,
    60427,
    60439,
    60451,
    60463,
    60475,
    60487,
    60499,
    60511,
    60523,
    60535,
    60547,
    60559,
    60571,
    60583,
    60595,
    60607,
    60619,
    60631,
    60643,
    60655,
    60667,
    60679,
    60691,
    60703,
    60715,
    60727,
    60739,
    60751,
    60763,
    60775,
    60787,
    60799,
    60811,
    60823,
    60835,
    60847,
    60855,
    60867,
    60879,
    60891,
    60903,
    60915,
    60927,
    60939,
    60951,
    60963,
    60975,
    60987,
    60998,
    61008,
    61020,
    61032,
    61044,
    61056,
    61068,
    61080,
    61092,
    61104,
    61116,
    61128,
    61140,
    61152,
    61164,
    61176,
    61188,
    61200,
    61212,
    61224,
    61236,
    61247,
    61258,
    61269,
    61281,
    61293,
    61305,
    61317,
    61329,
    61341,
    61353,
    61365,
    61377,
    61389,
    61401,
    61413,
    61425,
    61437,
    61449,
    61461,
    61473,
    61484,
    61491,
    61503,
    61515,
    61527,
    61539,
    61551,
    61563,
    61575,
    61587,
    61599,
    61610,
    61621,
    61632,
    61644,
    61656,
    61668,
    61680,
    61691,
    61703,
    61715,
    61727,
    61739,
    61751,
    61763,
    61775,
    61787,
    61799,
    61811,
    61823,
    61835,
    61847,
    61859,
    61871,
    61883,
    61895,
    61907,
    61919,
    61930,
    61942,
    61954,
    61966,
    61978,
    61990,
    62002,
    62014,
    62026,
    62034,
    62042,
    62049,
    62061,
    62073,
    62085,
    62097,
    62109,
    62121,
    62129,
    62141,
    62153,
    62165,
    62176,
    62187,
    62198,
    62210,
    62222,
    62234,
    62246,
    62258,
    62269,
    62280,
    62292,
    62304,
    62316,
    62328,
    62339,
    62351,
    62363,
    62375,
    62387,
    62399,
    62411,
    62423,
    62435,
    62446,
    62458,
    62470,
    62482,
    62494,
    62504,
    62515,
    62527,
    62529,
    62541,
    62553,
    62565,
    62577,
    62589,
    62601,
    62613,
    62625,
    62637,
    62649,
    62661,
    62673,
    62685,
    62695,
    62705,
    62715,
    62725,
    62735,
    62745,
    62755,
    62765,
    62775,
    62785,
    62795,
    62805,
    62817,
    62829,
    62841,
    62853,
    62865,
    62877,
    62889,
    62901,
    62913,
    62925,
    62937,
    62947,
    62957,
    62967,
    62977,
    62987,
    62997,
    63007,
    63017,
    63027,
    63037,
    63047,
    63057,
    63067,
    63077,
    63087,
    63097,
    63107,
    63117,
    63127,
    63137,
    63147,
    63157,
    63167,
    63177,
    63187,
    63197,
    63209,
    63221,
    63233,
    63245,
    63257,
    63269,
    63281,
    63293,
    63305,
    63317,
    63329,
    63341,
    63353,
    63365,
    63377,
    63389,
    63401,
    63413,
    63425,
    63437,
    63449,
    63459,
    63469,
    63479,
    63489,
    63499,
    63508,
    63517,
    63527,
    63537,
    63547,
    63557,
    63567,
    63579,
    63591,
    63603,
    63615,
    63627,
    63639,
    63651,
    63663,
    63675,
    63687
    ];





//start copying here for js console

        function makeHttpObject() {
            try {return new XMLHttpRequest();}
            catch (error) {}
            try {return new ActiveXObject("Msxml2.XMLHTTP");}
            catch (error) {}
            try {return new ActiveXObject("Microsoft.XMLHTTP");}
            catch (error) {}
        
            throw new Error("Could not create HTTP request object.");
        }

         //var budget_ids = [54380,54392];


for (z=0; z< budget_ids.length; z++){   //loop thru all budget internal ids

    //check to see if cust record [z] exists LOAD it, if not then
    //CREATE custom budget record [z] then store it as an object
     



        //  report = https://system.na1.netsuite.com/app/reporting/reportrunner.nl?cr=587&reload=t&whence=
        var request = makeHttpObject();
        request.open("GET", "https://system.na1.netsuite.com/app/accounting/transactions/budgets.nl?id="+budget_ids[z], true);
        request.send(null);
        request.onreadystatechange = function(){
            if (request.readyState == 4){
            //console.log(request.responseText);    // the HTML of the report
            //request.responseText;
             htmldata = request.responseText;

             budgetdata = '';

            rec = nlapiCreateRecord('customrecord_budgetcap', {recordmode: 'dynamic'} );



             frag = document.createRange().createContextualFragment(htmldata);
            
            //console.log(frag);

                //search thru each row and then each column of that row
            var rows = parseFloat( frag.getElementById("budget_splits").rows.length );
            var cols = parseFloat( frag.getElementById("budget_splits").rows[0].cells.length );

            console.log('rows='+rows+' cols='+cols);


            //get the headers
            dataheaders = [];
            console.log(frag.querySelector("#budgetheader > td.listheadertdleft.listheadertextb.uir-column-large > div").textContent );
            dataheaders.push(frag.querySelector("#budgetheader > td.listheadertdleft.listheadertextb.uir-column-large > div").textContent);
            for (i=2; i<cols+1; i++){
                console.log(frag.querySelector("#budgetheader > td:nth-child("+i+") > div").textContent ); //months
                dataheaders.push(frag.querySelector("#budgetheader > td:nth-child("+i+") > div").textContent);
            }


            var rowhead = "";
            var rowdata = [];

            //budget_ids

            //when in a row loop thru each column
            for (y=0; y<rows-1; y++){
                if (y % 2 == 1){ var etc = "hl" }else{ var etc = "" }   //only odds have hl added to class
                //first get header for row
                console.log(frag.querySelector("#budgetrow"+y+" > td.uir-list-row-cell.listtext"+etc).textContent );
                rowhead = frag.querySelector("#budgetrow"+y+" > td.uir-list-row-cell.listtext"+etc).textContent;
                rec.setFieldValue('custrecord_account', String(rowhead));
            
                /*
                    for (i=2; i<cols+1; i++){
                        //console.log(frag.querySelector("#budgetheader > td:nth-child("+i+") > div").textContent ); //months
                        console.log(frag.querySelector("#budgetrow"+y+" > td:nth-child("+i+")").textContent ); // data
                        curr = frag.querySelector("#budgetrow"+y+" > td:nth-child("+i+")").textContent;
                        newcurr = Number(curr.replace(/[^0-9\.-]+/g,""));
                        rowdata.push(newcurr);
                        //document.querySelector("#budgetrow0 > td:nth-child(5)").textContent;

                    }
                */

                rowdata[0] =  Number((frag.querySelector("#budgetrow"+y+" > td:nth-child("+2+")").textContent).replace(/[^0-9\.-]+/g,""));
                rowdata[1] =  Number((frag.querySelector("#budgetrow"+y+" > td:nth-child("+3+")").textContent).replace(/[^0-9\.-]+/g,""));
                rowdata[2] =  Number((frag.querySelector("#budgetrow"+y+" > td:nth-child("+4+")").textContent).replace(/[^0-9\.-]+/g,""));
                rowdata[3] =  Number((frag.querySelector("#budgetrow"+y+" > td:nth-child("+5+")").textContent).replace(/[^0-9\.-]+/g,""));
                rowdata[4] =  Number((frag.querySelector("#budgetrow"+y+" > td:nth-child("+6+")").textContent).replace(/[^0-9\.-]+/g,""));
                rowdata[5] =  Number((frag.querySelector("#budgetrow"+y+" > td:nth-child("+7+")").textContent).replace(/[^0-9\.-]+/g,""));
                rowdata[6] =  Number((frag.querySelector("#budgetrow"+y+" > td:nth-child("+8+")").textContent).replace(/[^0-9\.-]+/g,""));
                rowdata[7] =  Number((frag.querySelector("#budgetrow"+y+" > td:nth-child("+9+")").textContent).replace(/[^0-9\.-]+/g,""));
                rowdata[8] =  Number((frag.querySelector("#budgetrow"+y+" > td:nth-child("+10+")").textContent).replace(/[^0-9\.-]+/g,""));
                rowdata[9] =  Number((frag.querySelector("#budgetrow"+y+" > td:nth-child("+11+")").textContent).replace(/[^0-9\.-]+/g,""));
                rowdata[10] =  Number((frag.querySelector("#budgetrow"+y+" > td:nth-child("+12+")").textContent).replace(/[^0-9\.-]+/g,""));
                rowdata[11] =  Number((frag.querySelector("#budgetrow"+y+" > td:nth-child("+13+")").textContent).replace(/[^0-9\.-]+/g,""));
                rowdata[12] =  Number((frag.querySelector("#budgetrow"+y+" > td:nth-child("+14+")").textContent).replace(/[^0-9\.-]+/g,""));
                    
                rec.setFieldValue('custrecord_jan', parseFloat(rowdata[0]) );
                rec.setFieldValue('custrecord_feb', parseFloat(rowdata[1]));
                rec.setFieldValue('custrecord_mar', parseFloat(rowdata[2]));
                rec.setFieldValue('custrecord_apr', parseFloat(rowdata[3]) );
                rec.setFieldValue('custrecord_may', parseFloat(rowdata[4]));
                rec.setFieldValue('custrecord_jun', parseFloat(rowdata[5]));
                rec.setFieldValue('custrecord_jul', parseFloat(rowdata[6]));
                rec.setFieldValue('custrecord_aug', parseFloat(rowdata[7]));
                rec.setFieldValue('custrecord_sep', parseFloat(rowdata[8]));
                rec.setFieldValue('custrecord_oct', parseFloat(rowdata[9]));
                rec.setFieldValue('custrecord_nov', parseFloat(rowdata[10]));
                rec.setFieldValue('custrecord_dec', parseFloat(rowdata[11]));
                rec.setFieldValue('custrecord_total', parseFloat(rowdata[12]));

                dept = frag.querySelector("#main_form > table > tbody > tr:nth-child(2) > td > table > tbody > tr > td:nth-child(2) > table > tbody > tr:nth-child(3) > td > div > span.uir-field.inputreadonly > span").textContent;
                loc = frag.querySelector("#main_form > table > tbody > tr:nth-child(2) > td > table > tbody > tr > td:nth-child(2) > table > tbody > tr:nth-child(4) > td > div > span.uir-field.inputreadonly > span").textContent;

                try{
                    rec.setFieldValue('custrecord_department', String(dept));
                    rec.setFieldValue('custrecord_location', String(loc));
                }catch(e){
                    console.log(e.message);
                }

                //check search to see if account, dept, loc, and total? are already there
                //customsearch_budgetcapturecheck
                //var foundmatch=0;
                var filters = [
                    new nlobjSearchFilter('custrecord_account',null,'is',rowhead),
                    new nlobjSearchFilter('custrecord_department',null,'is',dept),
                    new nlobjSearchFilter('custrecord_location',null,'is',loc)
                    //new nlobjSearchFilter('custrecord_total',null,'is',parseFloat(rowdata[12]))
                ];
                var srec = nlapiSearchRecord('customrecord_budgetcap','customsearch_budgetcapturecheck',filters);    //load the saved search by id (costs 10 governance units)
                //var gov = 10; //start tracking the governance units.. limit of 10,000 per saved search script
                //console.log(srec.length);
                try{
                    if (srec.length == null){
                        console.log('no match');
                    } else {
                        console.log('match='+srec.length);
                    }                    
                } catch(e){
                    console.log('no match');
                    nlapiSubmitRecord(rec);
                }
                console.log('gov='+ nlapiGetContext().getRemainingUsage() +' bud='+budget_ids[z]+' accnt='+rowhead );


            } // completed one row


            } //rdy state == 4
            //console.log('2.dept =='+dept );
        };  //func
        //console.log('4.dept =='+dept );
} //end budget_ids loop
//console.log('5.dept =='+dept );


//    } //if role==3

//} //end function









                //var scols = srec[0].getAllColumns();  // get all columns of our search
                
                /*
                for (var j=0; srec != null && j < srec.length; j++){      // cycle thru each row of search
                    var saccnt = srec[j].getValue(scols[0]);  // nlobjSearchResult.getValue ( name , join , summary )
                    var sdep = srec[j].getValue(scols[1]);
                    var sloc = srec[j].getValue(scols[2]);
                    var stot = srec[j].getValue(scols[3]);
                    console.log(saccnt+' '+sdep+' '+sloc+' '+stot);
                    if(saccnt == rowhead && sdep == dept && sloc == loc ){
                        foundmatch=1;
                    }else{
                        foundmatch=0;
                    }

                }
                

                console.log(foundmatch);

                if (foundmatch=0){
                    nlapiSubmitRecord(rec);
                }
                */
                
               
















/*
    #budgetrow0 > td.uir-list-row-cell.listtext
    #budgetrow1 > td.uir-list-row-cell.listtexthl
    #budgetrow2 > td.uir-list-row-cell.listtext
    #budgetrow3 > td.uir-list-row-cell.listtexthl
    #budgetrow26 > td.uir-list-row-cell.listtext
    #budgetrow31 > td.uir-list-row-cell.listtexthl

    #budgetrow0 > td:nth-child(2)
    #budgetrow0 > td:nth-child(14)





  function getElementByXpath(path) {//document
    return document.evaluate(path, htmldata, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;
  }
  



//search thru each row and then each column of that row
var rows = document.getElementById("rptdataarea").rows.length;
var cols = document.getElementById("rptdataarea").rows[0].cells.length;

console.log('rows='+rows+' cols='+cols);



for (i=2; i<rows+1; i++){

    // if there's any data in column 2 then grab everything in row
    try{

        if 

    }catch(e){}
}










console.log(getElementByXpath('//*[@id="budgetheader"]/td[2]/div/text()');


*/





  //console.log( (getElementByXpath('//*[@id="rptcolheader"]/tbody/tr[2]/td[1]')).innerHTML );



//*[@id="rptdataarea"]/tbody/tr[4]/td[1]/text()  // "Income"

//console.log( (getElementByXpath('//*[@id="rptdataarea"]/tbody/tr[6]/td[1]/a')).innerHTML ); // 4000 - Revenue from donations

//*[@id="rptdataarea"]/tbody/tr[7]/td[1]/a  // 4010 - Individual/small business contributions
//*[@id="rptdataarea"]/tbody/tr[8]/td[1]/a
//*[@id="rptdataarea"]/tbody/tr[9]/td[1]/a  // 4030 - Fundraising Event Donations/Grants


//*[@id="rptdataarea"]/tbody/tr[7]/td[2]/a  // first columns first row's data
//*[@id="rptdataarea"]/tbody/tr[7]/td[5]/a  // last column first row's data



//var header2 = '//*[@id="rptcolheader"]/tbody/tr[2]/td[2]';



/*
//CSV
        // Creating a file name
        var fname = 'Invoice Corrections Report - Bill QTY = Fill QTY ' + date;    

        // Write to a CSV file
        var fileObj = file.create({
            name: fname,
            fileType: file.Type.CSV,
            contents: resultSet.join('\n')
        });
        // Accounting > Closing Month > Invoice Corrections
        fileObj.folder = 4724267;
        fileObj.save();
    }

    return {
        execute: InvoiceCorrections
    };

*/